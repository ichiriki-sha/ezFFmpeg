<Window x:Class="ezFFmpeg.Views.OptionDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:c="clr-namespace:ezFFmpeg.Converters"
        xmlns:b="clr-namespace:ezFFmpeg.Behaviors"
        ShowInTaskbar="False"   
        Icon="{x:Null}"
        Title="オプション" Height="400" Width="600"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize">

    <i:Interaction.Triggers>
        <i:EventTrigger EventName="ContentRendered">
            <i:InvokeCommandAction Command="{Binding ShownCommand}" />
        </i:EventTrigger>
    </i:Interaction.Triggers>
    
    <Window.Resources>
        <c:InverseDoubleConverter x:Key="InverseDoubleConverter"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ★ タブ -->
        <TabControl Grid.Row="0">
            
            <!-- ▼ 一般タブ -->
            <TabItem Header="一般">

                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <!-- FFmpeg -->
                        <RowDefinition Height="30"/>
                        <!-- インストールフォルダ -->
                        <RowDefinition Height="30"/>
                        <!-- ログを保存する -->
                        <RowDefinition Height="27"/>
                        <!-- プロファイル -->
                        <RowDefinition Height="30"/>
                        <!-- プロファイルリスト -->
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="60"/>
                        <ColumnDefinition Width="50"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- ===============================
                     FFmpeg フォルダ
                     =============================== -->
                    <TextBlock Grid.Row="0" 
                               Grid.Column="0" 
                               Margin="0,0,0,0"
                               Text="FFmpeg" 
                               VerticalAlignment="Center" 
                               TextAlignment="Left"/>
                    
                    <Separator Grid.Row="0"
                               Grid.Column="1"
                               Grid.ColumnSpan="3"
                               Margin="0,0"/>

                    <TextBlock Grid.Row="1" 
                               Grid.Column="0" 
                               Grid.ColumnSpan="2" 
                               Margin="8,0,0,0"
                               Text="インストールフォルダ" 
                               VerticalAlignment="Center"
                               TextAlignment="Left"/>

                    <TextBox Grid.Row="1"  
                             Grid.Column="2"
                             Margin="0,0,4,0"
                             Height="25"
                             VerticalAlignment="Center"
                             VerticalContentAlignment="Center"
                             IsReadOnly="True"
                             Text="{Binding FFmpegFolderPath}"/>

                    <Button Grid.Row="1"  
                            Grid.Column="3"
                            Margin="0,0,0,0" 
                            Content="..."
                            Width="25"
                            Height="25"
                            VerticalAlignment="Center"
                            Command="{Binding BrowseCommand}"/>

                     <!--ログ出力--> 
                    <CheckBox x:Name="EnableLogCheckBox" 
                              Grid.Row="2" 
                              Grid.Column="2" 
                              Margin="8 0"
                              Content="実行ログを保存する"
                              VerticalAlignment="Center"
                              IsChecked="{Binding IsFFmpegEnableLog}"/>

                    <TextBlock Grid.Row="3" 
                               Grid.Column="0" 
                               Margin="0,0,0,0"
                               Text="プロファイル" 
                               VerticalAlignment="Center" 
                               TextAlignment="Left"/>
                    <Separator Grid.Row="3"
                               Grid.Column="1"
                               Grid.ColumnSpan="3"
                               Margin="0,0"/>

                    <Grid Grid.Row="4" 
                          Grid.Column="2" 
                          Grid.ColumnSpan="2" 
                          Margin="0,4">
                        
                        <Grid.RowDefinitions>
                            <!-- プロファイル一覧 -->
                            <RowDefinition Height="108"/>
                            <!-- ボタン -->
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- プロファイル一覧 -->
                        <ListView x:Name="PresetListView"
                                  Grid.Row="0"
                                  Grid.Column="0"
                                  Grid.ColumnSpan="2"
                                  Margin="0,0,4,0"
                                  ItemsSource="{Binding ProfileItems}"
                                  SelectedItem="{Binding SelectedProfile, Mode=TwoWay}">

                            <i:Interaction.Behaviors>
                                <b:ListViewDragDropBehavior />
                            </i:Interaction.Behaviors>
                            
                            <ListView.View>
                                
                                <GridView>

                                    <!-- デフォルト -->
                                    <GridViewColumn Width="30">
                                        <GridViewColumn.CellTemplate>

                                            <DataTemplate>
                                                <Image Source="pack://application:,,,/Resources/Images/Star.png"
                                                       Width="16"
                                                       Height="16"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       Visibility="{Binding IsDefault,
                                                           Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                            </DataTemplate>

                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>

                                    <!-- プロファイル名 -->
                                    <GridViewColumn Header="プロファイル名"
                                                    DisplayMemberBinding="{Binding ProfileName}"
                                                    Width="250"/>
                                </GridView>
                            </ListView.View>
                        </ListView>

                        <!-- ボタン -->
                        <StackPanel Grid.Row="1" 
                                    Grid.Column="0"
                                Orientation="Horizontal"
                                HorizontalAlignment="Left"
                                Margin="0,6,0,0">
                            <Button Content="既定(_D)"
                                Width="70"
                                Height="20"
                                IsEnabled="{Binding IsDefualtProfileEnabled}"
                                Command="{Binding DefaultProfileCommand}"/>
                        </StackPanel>
                        
                        <StackPanel Grid.Row="1" 
                                    Grid.Column="1"
                                Orientation="Horizontal"
                                HorizontalAlignment="Right"
                                Margin="0,6,0,0">
                            <Button Content="登録(_A)"
                                Width="70"
                                Height="20"
                                Margin="8,0,0,0"
                                IsEnabled="{Binding IsAddProfileEnabled}"
                                Command="{Binding AddProfileCommand}"/>
                            <Button Content="複写(_C)"
                                Width="70"
                                Height="20"
                                Margin="8,0,0,0"
                                IsEnabled="{Binding IsAddProfileEnabled}"
                                Command="{Binding AddProfileCommand}"/>
                            <Button Content="修正(_E)"
                                Width="70"
                                Height="20"
                                Margin="8,0,0,0"
                                IsEnabled="{Binding IsEditProfileEnabled}"
                                Command="{Binding EditProfileCommand}"/>
                            <Button Content="削除(_R)"
                                Width="70"
                                Height="20"
                                Margin="8,0,4,0"
                                IsEnabled="{Binding IsRemoveProfileEnabled}"
                                Command="{Binding RemoveProfileCommand}"/>
                        </StackPanel>
                    </Grid>


                </Grid>
            </TabItem>

            <!-- ▼ 詳細タブ -->
            <TabItem Header="詳細">
                
                <Grid Margin="10">

                    <Grid.RowDefinitions>
                        <!-- 並列数 -->
                        <RowDefinition Height="30"/>
                        <!-- GPU 使用 -->
                        <RowDefinition Height="30"/>
                        <RowDefinition Height="30"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="90"/>
                        <ColumnDefinition Width="20"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock
                               Grid.Row="0"
                               Grid.Column="0"
                               Grid.ColumnSpan="2" 
                               Margin="0,0,8,0"
                               Height="15"
                               Text="アクセラレーション" 
                               VerticalAlignment="Center"
                               TextAlignment="Left"/>
                    <Separator Grid.Row="0"
                               Grid.Column="1"
                               Grid.ColumnSpan="3"
                               Margin="0,0"/>

                    <!-- 並列数 -->
                    <TextBlock
                               Grid.Row="1"
                               Grid.Column="0"
                               Grid.ColumnSpan="2"
                               Margin="8,0,0,0"
                               Text="並列数" 
                               VerticalAlignment="Center"
                               TextAlignment="Left"/>

                    <Grid Grid.Row="1"
                          Grid.Column="2"
                          Grid.ColumnSpan="2"
                          VerticalAlignment="Center">
                        
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="60"/>
                            <ColumnDefinition Width="20"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBox x:Name="ParallelCountText" 
                                 Grid.Column="0"
                                 Grid.Row="0"
                                 Grid.RowSpan="2"
                                 Width="60"
                                 Height="20"
                                 TextAlignment="Right"
                                 VerticalContentAlignment="Center"
                                 Text="{Binding ParallelCountText}"
                                 b:TextBoxCaretInitializer.CaretToEndOnLoad="True">

                            <TextBox.InputBindings>
                                <KeyBinding Key="Up"
                                            Command="{Binding DataContext.ParallelCountUpCommand,
                                                          RelativeSource={RelativeSource AncestorType=Window}}"/>
                                <KeyBinding Key="Down"
                                            Command="{Binding DataContext.ParallelCountDownCommand,
                                                          RelativeSource={RelativeSource AncestorType=Window}}"/>
                            </TextBox.InputBindings>
                        </TextBox>

                        <RepeatButton Grid.Column="1"
                                      Grid.Row="0"
                                      BorderBrush="LightGray"
                                      BorderThickness="1"
                                      Delay="400"
                                      Interval="100"
                                      Focusable="False"
                                      Command="{Binding DataContext.ParallelCountUpCommand,
                                                RelativeSource={RelativeSource AncestorType=Window}}"
                                      b:FocusTargetBehavior.FocusTarget="{Binding ElementName=ParallelCountText}">


                            <Image Source="pack://application:,,,/Resources/Images/Up.png"
                                                       Width="16"
                                                       Height="6"/>
                        </RepeatButton>

                        <RepeatButton Grid.Column="1"
                                      Grid.Row="1"
                                      BorderBrush="LightGray"
                                      Delay="400"
                                      Interval="100"
                                      Focusable="False"
                                      Command="{Binding DataContext.ParallelCountDownCommand,
                                                RelativeSource={RelativeSource AncestorType=Window}}"
                                      b:FocusTargetBehavior.FocusTarget="{Binding ElementName=ParallelCountText}">


                            <Image Source="pack://application:,,,/Resources/Images/Down.png"
                                                        Width="16"
                                                        Height="6"/>
                        </RepeatButton>

                        <!-- 説明 -->
                        <TextBlock Grid.Column="2"
                                   Grid.Row="0"
                                   Grid.RowSpan="2"
                                   Text="{Binding ParallelRangeText}" 
                                   VerticalAlignment="Center"
                                   Margin="18 0 0 0"/>
                    </Grid>

                    <!-- GPU 使用 -->
                    <CheckBox Grid.Row="2" 
                              Grid.Column="2" 
                              Margin="8,0"
                              Content="GPU エンコードを使用する"
                              VerticalAlignment="Center" 
                              ToolTip="チェックするとGPUを使用するエンコードが選択肢に追加されます" 
                              IsChecked="{Binding UseGpu}" Height="15"/>
                </Grid>
            </TabItem>
            
        </TabControl>

        <!-- ★ OK / Cancel ボタン -->
        <StackPanel Grid.Row="1"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0 10 0 0">
            <Button x:Name="OkButton"
                    Content="OK(_O)"
                    Width="80"
                    Height="25"
                    IsDefault="True"
                    Margin="0 0 10 0"
                    Command="{Binding ApplyCommand}"/>
            <Button x:Name="CancelButton"
                    Content="キャンセル(_C)"
                    Width="80"
                    Height="25"
                    IsCancel="True"
                    Command="{Binding CancelCommand}"/>
        </StackPanel>

    </Grid>
</Window>
