# ezFFmpeg 概要

ezFFmpeg は、FFmpeg を C# / .NET アプリケーションから  
**安全・分かりやすく・拡張しやすく扱うためのGUI ツール**です。

FFmpeg の強力さと引き換えに発生しがちな  
「複雑なコマンド文字列」「オプション指定ミス」「実行時エラー」を  
**型安全な設計と明確な責務分離**によって解消することを目的としています。

---

## 背景と課題意識

FFmpeg は非常に高機能ですが、以下のような課題があります。

- コマンドが長く、文字列結合になりがち
- コーデックとエンコーダの関係が分かりにくい
- 出力フォーマットごとの制約を実行時まで検知できない
- UI アプリケーションでの利用が難しい
- COPY 指定などの「特殊ケース」がエラーの原因になりやすい

ezFFmpeg はこれらの課題を、  
**事前検証可能なモデル設計**と  
**FFmpeg コマンド生成の責務分離**によって解決します。

---

## 目的

ezFFmpeg の主な目的は以下の通りです。

- FFmpeg コマンド生成をコードとして表現できるようにする
- 不正な組み合わせを「実行前」に検知する
- UI アプリケーションから安全に利用できる設計にする
- 将来的な拡張（新コーデック・GPU・フォーマット）を容易にする

---

## 設計思想

### 1. Codec と Encoder の明確な分離

FFmpeg において、

- **Codec**：データ形式（H.264 / AAC / PCM など）
- **Encoder**：実装方法（libx264 / h264_nvenc / copy など）

であるにも関わらず、これらが混同されがちです。

ezFFmpeg ではこれを明確に分離し、

- `VideoCodec / AudioCodec`
- `VideoEncoder / AudioEncoder`

としてモデル化しています。

これにより、

- フォーマットが対応していないコーデック
- GPU 使用可否
- COPY の可否

などを事前に判断可能にしています。

---

### 2. COPY は「特殊なエンコーダ」として扱う

COPY（ストリームコピー）は便利ですが、

- 出力フォーマットとの互換性問題
- トラック構成の違い
- メタデータ不整合

など、エラー要因になりやすい指定です。

ezFFmpeg では COPY を単なる文字列指定ではなく、  
**特別扱いされた Encoder**として定義し、

- 使用可能かどうかを事前判定
- UI から無効化可能

としています。

---

### 3. FFmpeg 実行責務の分離

ezFFmpeg は以下を明確に分離しています。

- **モデル**：Codec / Encoder / OutputFormat
- **オプション生成**：ArgumentBuilder
- **実行**：FFmpegService

これにより、

- コマンド生成ロジックのテストが容易
- 実行方法（同期 / 非同期 / ログ制御）の差し替えが可能
- ffprobe との共存が容易

という利点があります。

---

### 4. UI フレンドリーな設計

ezFFmpeg は UI アプリケーションでの利用を前提としています。

- ComboBox / ListBox にそのままバインド可能
- 使用不可項目を事前に除外
- 推奨エンコーダの自動選択

これにより、  
「ユーザーが選べてはいけない選択肢」をそもそも表示しない  
設計を実現しています。

---

## 想定ユースケース

- FFmpeg を使った GUI アプリケーション
- バッチエンコードツール
- プリセット管理型の動画変換ソフト
- 将来的な CLI / Web API への展開

---

## 対象ユーザー

- FFmpeg を C# から使いたい開発者
- FFmpeg コマンドを直接書きたくない人
- GUI アプリで安全にエンコードしたい人
- 将来の拡張性を重視する人

---

## 非目標（やらないこと）

ezFFmpeg は以下を目的としません。

- FFmpeg の全オプション網羅
- FFmpeg 本体の置き換え
- 超低レベルな最適化制御

必要な部分だけを、安全に扱えることを重視します。

---

## 関連ドキュメント

- [Architecture](architecture.md)  
  → 全体構成・責務分離の詳細
- [FFmpeg-Options](ffmpeg-options.md)  
  → オプション設計方針
- [Profile](profile.md)  
  → プロファイル仕様
