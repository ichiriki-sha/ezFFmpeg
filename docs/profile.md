# Profile（変換プロファイル）

## 概要

**Profile（プロファイル）**は、ezFFmpeg における
**「変換設定一式をまとめた単位」**です。

FFmpeg の複雑なコマンドライン引数を直接扱う代わりに、
出力形式・エンコーダ・品質・解像度などを **1つの設定として管理**します。

Profile は UI（WPF）と連携し、
安全に編集・検証・再利用できる設計になっています。

---

## Profile の設計思想

FFmpeg では以下のような課題があります。

- コマンドが長く、再利用しづらい
- 組み合わせ次第でエラーになりやすい
- GPU / CPU の切り替えが分かりにくい

これを解決するため、ezFFmpeg では

> **人が理解できる変換単位 = Profile**

という抽象化を導入しています。

---

## Profile クラスの責務

Profile クラスは次の役割を担います。

- 変換設定の保持（状態管理）
- UI バインディング対応（BindableBase）
- 設定内容の妥当性検証
- プロファイルの複製・コピー

※ FFmpeg コマンド生成や実行は行いません。

---

## 識別情報

| プロパティ | 説明 |
|-----------|------|
| ProfileId | 内部管理用の一意な識別子 |
| ProfileName | UI に表示されるプロファイル名 |

---

## 出力設定

| プロパティ | 説明 |
|-----------|------|
| OutputFormat | 出力形式（例: mp4, mov） |
| OutputFolderPath | 出力先フォルダ |
| OutputFileFormat | 出力ファイル名フォーマット |
| IsOutputOverwrite | 既存ファイルの上書き可否 |

### 出力ファイル名フォーマット

以下のタグを使用できます。

- `{filename}` : ファイル名
- `{vcodec}` : ビデオコーデック
- `{acodec}` : オーディオコーデック
- `{quality}` : 品質レベル
- `{resolution}` : 解像度
- `{timestamp}` : タイムスタンプ

---

## ビデオ設定

| プロパティ | 説明 |
|-----------|------|
| IsVideoEnabled | ビデオ出力の有効 / 無効 |
| VideoEncoder | 使用するビデオエンコーダ |
| VideoQualityTier | 抽象化された品質レベル |
| VideoResolution | 出力解像度 |
| VideoFrameRateMode | フレームレート制御方式 |
| VideoFrameRate | 指定フレームレート |

### フレームレート制御方式

| モード | 説明 |
|------|------|
| Source / Passthrough | 入力のフレームレートを使用 |
| CFR | 固定フレームレート（fps 指定必須） |
| VFR | 可変フレームレート |

---

## オーディオ設定

| プロパティ | 説明 |
|-----------|------|
| IsAudioEnabled | オーディオ出力の有効 / 無効 |
| AudioEncoder | 使用するオーディオエンコーダ |
| AudioBitRate | ビットレート（Source / 固定値） |

---

## 管理用フラグ

| フラグ | 説明 |
|------|------|
| IsUserDefined | ユーザー定義プロファイルか |
| IsDefault | デフォルトプロファイルか |
| IsLastUsed | 最後に使用されたか |

※ 一意性は ProfileManager により管理されます。

---

## プロファイルの生成

### デフォルトプロファイル

- H.264 / MP4 を想定した初期設定
- 解像度・fps は Source
- オーディオは Copy

---

## プロファイルの複製

- 設定を引き継いだ新規 Profile を作成可能
- ProfileId を含めるか選択可能

---

## 妥当性検証（Validate）

- 必須項目チェック
- Video / Audio 有効時の整合性
- フレームレート指定の妥当性

UI からの保存・変換実行前に使用されます。

---

## ProfileManager との関係

ProfileManager は複数の Profile を管理します。

### 主な役割

- プロファイルの追加・更新・削除
- デフォルト / 最終使用プロファイル管理
- 優先プロファイル取得

### 優先順位

1. 最終使用プロファイル
2. デフォルトプロファイル
3. 先頭のプロファイル

---

## 今後の予定

- Profile の永続化（JSON 保存）
- Profile と FFmpeg オプションの対応表
- 用途別サンプル Profile の追加

